---
title: "p8105_hw2_sef2183"
author: "Sarah Forrest"
date: "2022-09-27"
output: github_document
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)
```

```{r load packages, echo = FALSE}
library(tidyverse)
library(readxl)
```

# Problem 1
## Read and Clean the Data
```{r problem 1 - read and manipulate data}
subway_df = 
  read_csv("data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>%
  janitor::clean_names() %>%
  select(line, station_name, station_latitude, station_longitude, route1, route2, route3, route4, route5, route6, route7, route8, route9, route10, route11, entry, vending, entrance_type, ada) %>%
  mutate(entry = recode(entry, "YES" = TRUE,  "NO" = FALSE))

subway_df

is.logical(subway_df$entry)
```

## Dataset Description: 
This dataset contains the variables: line, station_name, station_latitude, station_longitude, routes served (route1-route11), entry, vending, entrance_type, and ada (ADA compliance). 

So far, I imported the CSV file with the data using the `read_csv` function and a relative path to the data file. Then, I used the pipe operator to feed the data frame into the `janitor` package's `clean_names` function to  convert all variable names to lower case and put underscores in the gaps Then, I used the pipe operator again to feed the output of the `clean_names` function to the `select` function to retain only the variables of interest in the data frame. Then, I used the pipe operator again to feed the output of the `select` function into the `recode` function within `mutate` to convert the entry variable from character (`YES` vs `NO`) to a logical variable. Finally, the outcome of all of these processes are stored in the tibble `subway_df`. I printed out the data set to check the variables that were included in it and also checked that the entry variable was logical using the `is.logical` function which returned "TRUE".

The dimensions of the resulting `subway_df` tibble is 1,868 rows (observations) by 19 columns (variables).

These data are not tidy. Variables route1-route11 span 11 columns in the dataset. In order to be tidy, there should just be 1 column for the variable "route_number" with values for each route number and another column, "route_name" for the name of the corresponding subway.

## Dataset Questions:
```{r}
distinct_stations_df = distinct(subway_df, station_name, line, .keep_all = TRUE)

nrow(distinct_stations_df)
```

* There are 465 distinct stations.

```{r}
sum(distinct_stations_df$ada == "TRUE")
```

* 84 distinct stations are ADA compliant. 

```{r}
denom_df = filter(distinct_stations_df, vending == "NO")

denom = sum(distinct_stations_df$vending == "NO")
num = sum(denom_df$entry == "TRUE")

num / denom
```

* 5/9 station entrances / exits without vending allow entrance

```{r problem 1 - reformat data}
summary(subway_df)

subway_df$route8 <- as.character(subway_df$route8)
subway_df$route9 <- as.character(subway_df$route9)
subway_df$route10 <- as.character(subway_df$route10)
subway_df$route11 <- as.character(subway_df$route11)

summary(subway_df)

subway_long_df =
  subway_df %>%
  pivot_longer(
    route1:route11,
    names_to = "route_number",
    names_prefix = "route",
    values_to = "route_name")
  
subway_long_df
```

```{r}
distinct_stations_long_df = distinct(subway_long_df, station_name, line, .keep_all = TRUE)

sum(distinct_stations_long_df$route_name == "A")
```

60 distinct stations serve the A train. 

```{r}
a_df = filter(distinct_stations_long_df, route_name == "A") 
sum(a_df$ada == "TRUE")
```

17 of the stations that serve the A train are ADA compliant.

# Problem 2
```{r problem 2 - read and manipulate mr trash wheel data}
mrtrashwheel_df =
  read_excel("data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N534") %>%
  janitor::clean_names() %>%
  drop_na(dumpster) %>%
  mutate(dataset = "Mr. Trash Wheel") %>%
  mutate(sports_balls = round(sports_balls, digits = 0)) %>%
  mutate(sports_balls = as.integer(sports_balls))

class(mrtrashwheel_df$sports_balls)
```

```{r problem 2 - read and manipulate professor trash wheel data}
professortrashwheel_df =
  read_excel("data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", sheet = "Professor Trash Wheel", range = "A2:N116") %>%
  janitor::clean_names() %>%
  drop_na(dumpster) %>%
  mutate(dataset = "Professor Trash Wheel")

```

```{r problem 2 - combine trash wheel datasets}
trashwheel_df = full_join(mrtrashwheel_df, professortrashwheel_df) # CORRECT TYPE OF JOIN?

trashwheel_df
```

## Dataset Description: 
 
* The number of observations in the resulting dataset is `r nrow(trashwheel_df)`.

* Examples of key variables in the dataset include: Dumpster, Month, Year, Date, Weight (tons), Volume (cubic yards), Plastic Bottles, Polystyrene, Cigarette Butts, Glass Bottles, Grocery Bags, Chip Bags, Sports Balls, and Homes Powered. 

* For available data, the total weight of trash collected by Professor Trash Wheel is `r sum(professortrashwheel_df$weight_tons)`

```{r problem 2 - 2020 mr trach wheel dataset creation}
mrtrashwheel_2020_df =
  filter(mrtrashwheel_df, year == 2020)
```

* The total number of sports balls collected by Mr. Trash Wheel in 2020 was `r sum(mrtrashwheel_2020_df$sports_balls)`.

# Problem 3

```{r problem 3 - read and manipulate data}
pols_month_df = 
  read_csv("data/fivethirtyeight_datasets/pols-month.csv") %>%
  janitor::clean_names() %>%
  separate(mon, into = c("year", "month", "day"), sep = '-') %>%
  mutate(
    month = recode(month, "01" = 'January', "02" = 'February', "03" = 'March', "04" = 'April', "05" = 'May', "06" = 'June', "07" = 'July', "08" = 'August', "09" = 'September', "10" = 'October', "11" = 'November', "12" = 'December')) %>%
  mutate(
    president = case_when(prez_gop == 1 ~ "gop",
                          prez_gop != 1 ~ "dem")) %>%
  select(-prez_gop, -prez_dem, -day) %>%
  mutate(year = as.numeric(year))


snp_df = 
  read_csv("data/fivethirtyeight_datasets/snp.csv") %>%
  janitor::clean_names() %>%
  separate(date, into = c("month", "day", "year"), sep = '/') %>%
  mutate(
    month = recode(month, "1" = 'January', "2" = 'February', "3" = 'March', "4" = 'April', "5" = 'May', "6" = 'June', "7" = 'July', "8" = 'August', "9" = 'September', "10" = 'October', "11" = 'November', "12" = 'December')) %>%
  mutate(year = paste0("20", year)) %>%
  arrange(year, month) %>%
  relocate(year, month) %>%
  select(-day) %>% # NEED TO DROP DAY?
  mutate(year = as.numeric(year))


unemployment_df = 
  read_csv("data/fivethirtyeight_datasets/unemployment.csv") %>%
  janitor::clean_names() %>%
  pivot_longer(jan:dec,
    names_to = "month", 
    values_to = "unemployment") %>% # IS UNEMPLOYMENT THE RIGHT NAME?
  mutate(
    month = recode(month, "jan" = 'January', "feb" = 'February', "mar" = 'March', "apr" = 'April', "may" = 'May', "jun" = 'June', "jul" = 'July', "aug" = 'August', "sep" = 'September', "oct" = 'October', "nov" = 'November', "dec" = 'December'))
```

```{r problem 3 - merge datsets}
merged_df = 
  left_join(pols_month_df, snp_df) %>% # CORRCT JOIN?
  left_join(., unemployment_df) # CORRCT JOIN?

merged_df
```

## Dataset Descriptions: 
The pols month dataset contained the variables: year, month, gov_gop, sen_gop, rep_gop, gov_dem, sen_dem, rep_dem, and president. The snp dataset contained the variables: year, month, and close. The unemployment dataset contained the variables: year, month, and unemployment.

The resulting merged dataset contains `r nrow(merged_df)` rows/observations and `r ncol(merged_df)` columns/variables. The range of years in the dataset is: 
`r range(merged_df$year, na.rm = FALSE)`. It contains the variables: year, month, gov_gop, sen_gop, rep_gop, gov_dem, sen_dem, rep_dem, president, close, and unemployment.